<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diet Assistant PRO | Marco Massa</title>
    <meta name="description" content="Strumento professionale di Marco Massa per il calcolo macro e la conversione crudo-cotto.">
    <meta name="keywords" content="dieta, marco massa, calcolo macro, convertitore alimenti">
    <meta name="author" content="Marco Massa">
    
    <meta property="og:title" content="Diet Assistant PRO - Marco Massa">
    <meta property="og:description" content="Gestione pasti intelligente e multilingua.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://esempio.com/anteprima.jpg"> <style>
        :root { --primary: #D4AF37; --bg: #F5F7FA; --card: #ffffff; --text: #2D3436; --accent: #DFE6ED; --drawer: 280px; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; overflow-x: hidden; }
        
        /* Modale Disclaimer */
        .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        .modal-content { background-color: white; margin: 15% auto; padding: 25px; border-top: 5px solid var(--primary); width: 85%; max-width: 450px; border-radius: 12px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        
        /* Header e Navigazione */
        .header-bar { display: flex; align-items: center; justify-content: space-between; padding: 10px 20px; background: var(--card); border-bottom: 2px solid var(--primary); position: sticky; top: 0; z-index: 1000; }
        .sidebar { height: 100%; width: 0; position: fixed; z-index: 2000; top: 0; left: 0; background-color: #2D3436; overflow-x: hidden; transition: 0.3s; padding-top: 60px; }
        .sidebar a { padding: 15px 25px; text-decoration: none; font-size: 1.1rem; color: #BDC3C7; display: block; border-bottom: 1px solid #3d4548; }
        
        /* Layout Sezioni */
        .section { display: none; padding: 20px; max-width: 700px; margin: auto; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .card { background: var(--card); border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid var(--accent); }
        select, input { width: 100%; padding: 14px; margin: 10px 0; border-radius: 10px; border: 1px solid var(--accent); background: #F9FAFB; font-size: 1rem; box-sizing: border-box; outline: none; }
        
        /* Pulsanti e Risultati */
        .btn { width: 100%; padding: 16px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-switch { background: #F1F3F5; color: var(--text); border: 1px solid var(--accent); margin-bottom: 15px; }
        .btn-danger { background: #FF7675; color: white; margin-top: 15px; }
        
        .res-box { background: #F8F9FA; padding: 15px; border-radius: 12px; margin-top: 15px; border-left: 5px solid var(--primary); }
        .macro-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .macro-item { background: white; border: 1px solid var(--accent); padding: 10px; border-radius: 8px; text-align: center; }
        .macro-val { display: block; font-weight: bold; color: var(--primary); font-size: 1.1rem; }
        
        .alt-pasto-box { background: #E3FCEF; border: 1px solid #2ECC71; padding: 20px; border-radius: 12px; margin-top: 20px; position: relative; }
        .refresh-btn { position: absolute; top: 15px; right: 15px; background: #2ECC71; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .plate-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

    <div id="disclaimerModal" class="modal">
        <div class="modal-content">
            <h2 id="disc-title"></h2>
            <p id="disc-text"></p>
            <button class="btn btn-primary" onclick="closeModal()" id="btn-close-disc"></button>
        </div>
    </div>

    <div class="header-bar">
        <span style="font-size:28px; cursor:pointer; color:var(--primary)" onclick="openNav()">&#9776;</span>
        <span style="font-weight: 800; letter-spacing: -1px;">DIET ASSISTANT <span style="color:var(--primary)">PRO</span></span>
        <select id="lang-switch" onchange="changeLanguage()">
            <option value="it">ðŸ‡®ðŸ‡¹ IT</option><option value="en">ðŸ‡ºðŸ‡¸ EN</option>
            <option value="es">ðŸ‡ªðŸ‡¸ ES</option><option value="pt">ðŸ‡µðŸ‡¹ PT</option>
            <option value="fr">ðŸ‡«ðŸ‡· FR</option><option value="de">ðŸ‡©ðŸ‡ª DE</option>
        </select>
    </div>

    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" style="font-size:36px; text-align:right; padding-right:25px;" onclick="closeNav()">&times;</a>
        <a href="#" onclick="showSection('convertitore')" id="nav-conv"></a>
        <a href="#" onclick="showSection('calorie')" id="nav-cal"></a>
        <a href="#" onclick="showSection('composizione')" id="nav-comp"></a>
    </div>

    <div id="convertitore" class="section active">
        <h2 id="title-conv"></h2>
        <div class="card">
            <button class="btn btn-switch" onclick="switchModo()">ðŸ”„ <span id="modo-label"></span></button>
            <label id="lbl-cat1"></label><select id="conv-cat" onchange="filtraAlimenti('conv')"></select>
            <label id="lbl-ali1"></label><select id="conv-alimento" onchange="eseguiConversione()"></select>
            <input type="number" id="conv-valore" oninput="eseguiConversione()">
            <div id="conv-res" class="res-box" style="display:none"></div>
        </div>
    </div>

    <div id="calorie" class="section">
        <h2 id="title-cal"></h2>
        <div class="card">
            <label id="lbl-cat2"></label><select id="cal-cat" onchange="filtraAlimenti('cal')"></select>
            <label id="lbl-ali2"></label><select id="cal-alimento"></select>
            <input type="number" id="cal-peso">
            <button class="btn btn-primary" onclick="calcolaMacroSingolo()" id="btn-calc"></button>
            <div id="cal-res" class="res-box" style="display:none"></div>
        </div>
    </div>

    <div id="composizione" class="section">
        <h2 id="title-comp"></h2>
        <div class="card">
            <label id="lbl-cat3"></label><select id="comp-cat" onchange="filtraAlimenti('comp')"></select>
            <label id="lbl-ali3"></label><select id="comp-alimento"></select>
            <input type="number" id="comp-peso">
            <button class="btn btn-primary" onclick="aggiungiPiatto()" id="btn-add"></button>
        </div>
        <div id="piatto-area" style="display:none">
            <div class="card">
                <h3 id="piatto-res-title"></h3>
                <div id="lista-piatto"></div>
                <div id="totale-pasto-box" class="res-box"></div>
                <button class="btn btn-danger" onclick="svuotaPiatto()" id="btn-empty"></button>
            </div>
            <div id="box-alternativa" class="alt-pasto-box">
                <button class="refresh-btn" onclick="rinfrescaAlternativa()">ðŸ”„</button>
                <span style="color:#27ae60; font-weight:bold; display:block; margin-bottom:10px" id="alt-title"></span>
                <div id="testo-alternativa"></div>
            </div>
        </div>
    </div>
  <script>
        const uiTrans = {
            it: { discTitle: "AVVISO IMPORTANTE", discText: "I dati sono puramente illustrativi. Consulta sempre un professionista!", btnClose: "ACCETTO", navConv: "âš–ï¸ Convertitore", navCal: "ðŸ”¥ Calcolatore", navComp: "ðŸ¥— Crea Pasto", cat1: "Primi Piatti", cat2: "Secondi Piatti", cat3: "Contorni", cat4: "Frutta", raw: "CRUDO â†’ COTTO", cooked: "COTTO â†’ CRUDO", lblCat: "Categoria", lblAli: "Alimento", btnCalc: "CALCOLA MACRO", btnAdd: "AGGIUNGI AL PIATTO", btnEmpty: "SVUOTA TUTTO", altTitle: "ALTERNATIVA SUGGERITA:", weight: "Peso stimato", plate: "Il Tuo Piatto:", placeholder: "Grammi (g)" },
            en: { discTitle: "IMPORTANT NOTICE", discText: "Data for information only. Consult a professional!", btnClose: "I AGREE", navConv: "âš–ï¸ Converter", navCal: "ðŸ”¥ Calculator", navComp: "ðŸ¥— Meal Planner", cat1: "Main Courses", cat2: "Proteins", cat3: "Vegetables", cat4: "Fruits", raw: "RAW â†’ COOKED", cooked: "COOKED â†’ RAW", lblCat: "Category", lblAli: "Food", btnCalc: "CALCULATE", btnAdd: "ADD TO PLATE", btnEmpty: "CLEAR ALL", altTitle: "SUGGESTED OPTION:", weight: "Estimated weight", plate: "Your Plate:", placeholder: "Grams (g)" },
            es: { discTitle: "AVISO IMPORTANTE", discText: "Datos informativos. Â¡Consulte a un profesional!", btnClose: "ACEPTO", navConv: "âš–ï¸ Convertidor", navCal: "ðŸ”¥ Calculadora", navComp: "ðŸ¥— Crear MenÃº", cat1: "Primeros Platos", cat2: "ProteÃ­nas", cat3: "Verduras", cat4: "Frutas", raw: "CRUDO â†’ COCIDO", cooked: "COCIDO â†’ CRUDO", lblCat: "CategorÃ­a", lblAli: "Alimento", btnCalc: "CALCULAR", btnAdd: "AÃ‘ADIR", btnEmpty: "BORRAR TODO", altTitle: "OPCIÃ“N ALTERNATIVA:", weight: "Peso estimado", plate: "Tu Plato:", placeholder: "Gramos (g)" },
            pt: { discTitle: "AVISO", discText: "Dados informativos. Consulte um profissional!", btnClose: "ACEITO", navConv: "âš–ï¸ Conversor", navCal: "ðŸ”¥ Calculadora", navComp: "ðŸ¥— Criar RefeiÃ§Ã£o", cat1: "Primeiros", cat2: "ProteÃ­nas", cat3: "Vegetais", cat4: "Frutas", raw: "CRU â†’ COZIDO", cooked: "COZIDO â†’ CRU", lblCat: "Categoria", lblAli: "Alimento", btnCalc: "CALCULAR", btnAdd: "ADICIONAR", btnEmpty: "LIMPAR", altTitle: "OPÃ‡ÃƒO ALTERNATIVA:", weight: "Peso estimado", plate: "Sua RefeiÃ§Ã£o:", placeholder: "Gramas (g)" },
            fr: { discTitle: "AVIS", discText: "DonnÃ©es informatives. Consultez un professionnel !", btnClose: "OK", navConv: "âš–ï¸ Convertisseur", navCal: "ðŸ”¥ Calculateur", navComp: "ðŸ¥— CrÃ©er Repas", cat1: "Plats Principaux", cat2: "ProtÃ©ines", cat3: "LÃ©gumes", cat4: "Fruits", raw: "CRU â†’ CUIT", cooked: "CUIT â†’ CRU", lblCat: "CatÃ©gorie", lblAli: "Aliment", btnCalc: "CALCULER", btnAdd: "AJOUTER", btnEmpty: "VIDER", altTitle: "OPTION ALTERNATIVE :", weight: "Poids estimÃ©", plate: "Votre Repas :", placeholder: "Grammes (g)" },
            de: { discTitle: "HINWEIS", discText: "Nur zur Information. Fachmann konsultieren!", btnClose: "OK", navConv: "âš–ï¸ Konverter", navCal: "ðŸ”¥ Rechner", navComp: "ðŸ¥— Mahlzeitplaner", cat1: "Hauptspeisen", cat2: "Proteine", cat3: "GemÃ¼se", cat4: "FrÃ¼chte", raw: "ROH â†’ GEKOCHT", cooked: "GEKOCHT â†’ ROH", lblCat: "Kategorie", lblAli: "Lebensmittel", btnCalc: "BERECHNEN", btnAdd: "HINZUFÃœGEN", btnEmpty: "LEEREN", altTitle: "ALTERNATIVE:", weight: "Gewicht geschÃ¤tzt", plate: "Ihre Mahlzeit:", placeholder: "Gramm (g)" }
        };

        const db = {
            primo: {
                pasta: { it: "Pasta semola", en: "Pasta", kcal: 353, p: 13, c: 72, f: 1.5, ratio: 2.1 },
                pasta_int: { it: "Pasta Integrale", en: "Whole Pasta", kcal: 348, p: 14, c: 65, f: 2.5, ratio: 2.0 },
                riso_bas: { it: "Riso Basmati", en: "Basmati Rice", kcal: 345, p: 8.5, c: 78, f: 0.6, ratio: 2.5 },
                riso_int: { it: "Riso Integrale", en: "Brown Rice", kcal: 337, p: 7.5, c: 74, f: 1.9, ratio: 2.4 },
                patate: { it: "Patate", en: "Potatoes", kcal: 77, p: 2, c: 17, f: 0.1, ratio: 0.9 },
                quinoa: { it: "Quinoa", en: "Quinoa", kcal: 368, p: 14, c: 64, f: 6, ratio: 2.4 },
                farro: { it: "Farro", en: "Spelt", kcal: 335, p: 15, c: 67, f: 2.5, ratio: 2.3 },
                orzo: { it: "Orzo", en: "Barley", kcal: 354, p: 12, c: 73, f: 2.3, ratio: 2.4 },
                couscous: { it: "Couscous", en: "Couscous", kcal: 356, p: 12, c: 72, f: 0.6, ratio: 2.2 },
                pane: { it: "Pane Comune", en: "White Bread", kcal: 265, p: 9, c: 49, f: 1.5, ratio: 1.0 },
                pane_int: { it: "Pane Integrale", en: "Whole Bread", kcal: 243, p: 8, c: 44, f: 2.0, ratio: 1.0 },
                avena: { it: "Avena", en: "Oats", kcal: 389, p: 16, c: 66, f: 7, ratio: 2.2 },
                polenta: { it: "Polenta (Farina)", en: "Cornmeal", kcal: 345, p: 8, c: 75, f: 1.2, ratio: 3.5 },
                gnocchi: { it: "Gnocchi di Patate", en: "Potato Gnocchi", kcal: 150, p: 3, c: 35, f: 0.5, ratio: 1.1 }
            },
            secondo: {
                pollo: { it: "Petto di Pollo", en: "Chicken Breast", kcal: 110, p: 23.5, c: 0, f: 1, ratio: 0.75 },
                tacchino: { it: "Fesa Tacchino", en: "Turkey Breast", kcal: 107, p: 24, c: 0, f: 1.2, ratio: 0.75 },
                manzo_magro: { it: "Manzo Magro", en: "Lean Beef", kcal: 121, p: 20.5, c: 0, f: 4.3, ratio: 0.7 },
                maiale_lonza: { it: "Lonza Maiale", en: "Pork Loin", kcal: 145, p: 21, c: 0, f: 6.5, ratio: 0.75 },
                merluzzo: { it: "Merluzzo", en: "Cod", kcal: 71, p: 17, c: 0, f: 0.3, ratio: 0.8 },
                salmone: { it: "Salmone Fresco", en: "Salmon", kcal: 202, p: 20, c: 0, f: 13, ratio: 0.85 },
                orata: { it: "Orata", en: "Sea Bream", kcal: 110, p: 20, c: 0, f: 3.5, ratio: 0.8 },
                branzino: { it: "Branzino", en: "Sea Bass", kcal: 103, p: 20, c: 0, f: 2.5, ratio: 0.8 },
                tonno_nat: { it: "Tonno Naturale", en: "Tuna (Water)", kcal: 103, p: 24, c: 0, f: 0.8, ratio: 1.0 },
                tonno_olio: { it: "Tonno Olio (Sgocciolato)", en: "Tuna (Oil)", kcal: 190, p: 25, c: 0, f: 10, ratio: 1.0 },
                uova: { it: "Uova Intere", en: "Eggs", kcal: 155, p: 13, c: 1, f: 11, ratio: 1.0 },
                albume: { it: "Albume d'Uovo", en: "Egg White", kcal: 52, p: 11, c: 0.7, f: 0.2, ratio: 1.0 },
                tofu: { it: "Tofu", en: "Tofu", kcal: 76, p: 8, c: 1.9, f: 4.8, ratio: 1.0 },
                tempeh: { it: "Tempeh", en: "Tempeh", kcal: 190, p: 19, c: 9, f: 11, ratio: 1.0 },
                seitan: { it: "Seitan", en: "Seitan", kcal: 120, p: 24, c: 4, f: 0.5, ratio: 1.0 },
                bresaola: { it: "Bresaola", en: "Bresaola", kcal: 151, p: 33, c: 0.5, f: 2, ratio: 1.0 },
                fesa_tacchino_aff: { it: "Fesa Tacchino Affett.", en: "Sliced Turkey", kcal: 100, p: 21, c: 1, f: 1.5, ratio: 1.0 },
                fiocchi_latte: { it: "Fiocchi di Latte", en: "Cottage Cheese", kcal: 98, p: 12, c: 3, f: 4, ratio: 1.0 }
            },
            contorno: {
                zucchine: { it: "Zucchine", en: "Zucchini", kcal: 17, p: 1.3, c: 3, f: 0.1, ratio: 0.9 },
                broccoli: { it: "Broccoli", en: "Broccoli", kcal: 34, p: 3, c: 6, f: 0.4, ratio: 1.0 },
                spinaci: { it: "Spinaci", en: "Spinach", kcal: 23, p: 2.9, c: 3.6, f: 0.4, ratio: 0.8 },
                carote: { it: "Carote", en: "Carrots", kcal: 41, p: 0.9, c: 9.6, f: 0.2, ratio: 1.0 },
                peperoni: { it: "Peperoni", en: "Peppers", kcal: 31, p: 1, c: 6, f: 0.3, ratio: 0.9 },
                fagiolini: { it: "Fagiolini", en: "Green Beans", kcal: 31, p: 1.8, c: 7, f: 0.2, ratio: 1.0 },
                cavolfiore: { it: "Cavolfiore", en: "Cauliflower", kcal: 25, p: 1.9, c: 5, f: 0.3, ratio: 1.0 },
                melanzane: { it: "Melanzane", en: "Eggplant", kcal: 25, p: 1, c: 6, f: 0.2, ratio: 0.9 },
                finocchi: { it: "Finocchi", en: "Fennel", kcal: 31, p: 1.2, c: 7, f: 0.2, ratio: 1.0 },
                zucca: { it: "Zucca", en: "Pumpkin", kcal: 26, p: 1, c: 6.5, f: 0.1, ratio: 0.8 },
                funghi: { it: "Funghi Champignon", en: "Mushrooms", kcal: 22, p: 3, c: 3, f: 0.3, ratio: 0.9 },
                insalata: { it: "Insalata Verde", en: "Salad", kcal: 15, p: 1.3, c: 2.2, f: 0.2, ratio: 1.0 }
            },
            frutta: {
                mela: { it: "Mela", en: "Apple", kcal: 52, p: 0.3, c: 14, ratio: 1 },
                banana: { it: "Banana", en: "Banana", kcal: 89, p: 1.1, c: 23, ratio: 1 },
                pera: { it: "Pera", en: "Pear", kcal: 57, p: 0.4, c: 15, ratio: 1 },
                arancia: { it: "Arancia", en: "Orange", kcal: 47, p: 0.9, c: 12, ratio: 1 },
                fragole: { it: "Fragole", en: "Strawberries", kcal: 32, p: 0.7, c: 8, ratio: 1 },
                kiwi: { it: "Kiwi", en: "Kiwi", kcal: 61, p: 1.1, c: 15, ratio: 1 },
                ananas: { it: "Ananas", en: "Pineapple", kcal: 50, p: 0.5, c: 13, ratio: 1 },
                mango: { it: "Mango", en: "Mango", kcal: 60, p: 0.8, c: 15, ratio: 1 },
                uva: { it: "Uva", en: "Grapes", kcal: 67, p: 0.6, c: 17, ratio: 1 },
                pesca: { it: "Pesca", en: "Peach", kcal: 39, p: 0.9, c: 10, ratio: 1 },
                albicocca: { it: "Albicocca", en: "Apricot", kcal: 48, p: 1.4, c: 11, ratio: 1 },
                ciliegie: { it: "Ciliegie", en: "Cherries", kcal: 50, p: 1, c: 12, ratio: 1 },
                mirtilli: { it: "Mirtilli", en: "Blueberries", kcal: 57, p: 0.7, c: 14, ratio: 1 },
                lamponi: { it: "Lamponi", en: "Raspberries", kcal: 52, p: 1.2, c: 12, ratio: 1 },
                melone: { it: "Melone", en: "Melon", kcal: 34, p: 0.8, c: 8, ratio: 1 },
                anguria: { it: "Anguria", en: "Watermelon", kcal: 30, p: 0.6, c: 8, ratio: 1 },
                prugna: { it: "Prugna", en: "Plum", kcal: 46, p: 0.7, c: 11, ratio: 1 },
                pompelmo: { it: "Pompelmo", en: "Grapefruit", kcal: 42, p: 0.8, c: 11, ratio: 1 },
                fichi: { it: "Fichi Freschi", en: "Figs", kcal: 74, p: 0.8, c: 19, ratio: 1 },
                mandarini: { it: "Mandarini", en: "Mandarins", kcal: 53, p: 0.8, c: 13, ratio: 1 }
            }
        };
        // 5. MOTORE LOGICO (CALCOLI E NAVIGAZIONE)
        let currentLang = 'it'; let modoCrudo = true; let pasto = []; let lastMacros = {c:0, p:0};

        window.onload = () => {
            const browserLang = navigator.language.split('-')[0];
            if(uiTrans[browserLang]) currentLang = browserLang;
            document.getElementById('lang-switch').value = currentLang;
            updateUI();
            document.getElementById('disclaimerModal').style.display = 'block';
        };

        function updateUI() {
            const t = uiTrans[currentLang];
            document.getElementById('disc-title').innerText = t.discTitle;
            document.getElementById('disc-text').innerText = t.discText;
            document.getElementById('btn-close-disc').innerText = t.btnClose;
            document.getElementById('nav-conv').innerText = t.navConv;
            document.getElementById('nav-cal').innerText = t.navCal;
            document.getElementById('nav-comp').innerText = t.navComp;
            document.getElementById('title-conv').innerText = t.navConv;
            document.getElementById('title-cal').innerText = t.navCal;
            document.getElementById('title-comp').innerText = t.navComp;
            document.getElementById('modo-label').innerText = modoCrudo ? t.raw : t.cooked;
            document.getElementById('btn-calc').innerText = t.btnCalc;
            document.getElementById('btn-add').innerText = t.btnAdd;
            document.getElementById('btn-empty').innerText = t.btnEmpty;
            document.getElementById('alt-title').innerText = t.altTitle;
            document.getElementById('piatto-res-title').innerText = t.plate;
            
            document.querySelectorAll('input[type="number"]').forEach(i => i.placeholder = t.placeholder);
            document.querySelectorAll('[id^="lbl-cat"]').forEach(el => el.innerText = t.lblCat);
            document.querySelectorAll('[id^="lbl-ali"]').forEach(el => el.innerText = t.lblAli);
            
            ['conv-cat', 'cal-cat', 'comp-cat'].forEach(id => {
                const s = document.getElementById(id);
                s.innerHTML = `<option value="primo">${t.cat1}</option><option value="secondo">${t.cat2}</option><option value="contorno">${t.cat3}</option>${id !== 'conv-cat' ? `<option value="frutta">${t.cat4}</option>` : ''}`;
            });
            filtraAlimenti('conv'); filtraAlimenti('cal'); filtraAlimenti('comp');
        }

        function changeLanguage() { 
            currentLang = document.getElementById('lang-switch').value; 
            updateUI(); 
            if(pasto.length > 0) aggiornaPiattoUI(); 
        }
        
        function filtraAlimenti(tipo) {
            const cat = document.getElementById(tipo + '-cat').value;
            const select = document.getElementById(tipo + '-alimento');
            select.innerHTML = "";
            Object.keys(db[cat]).sort().forEach(key => {
                select.add(new Option(db[cat][key][currentLang] || db[cat][key].it, key));
            });
        }

        function switchModo() { modoCrudo = !modoCrudo; updateUI(); eseguiConversione(); }

        function eseguiConversione() {
            const cat = document.getElementById('conv-cat').value;
            const key = document.getElementById('conv-alimento').value;
            const val = document.getElementById('conv-valore').value;
            const res = document.getElementById('conv-res');
            if(val > 0) {
                res.style.display = "block";
                const ratio = db[cat][key].ratio;
                res.innerHTML = `${uiTrans[currentLang].weight}: <strong>~${modoCrudo ? (val*ratio).toFixed(0) : (val/ratio).toFixed(0)}g</strong>`;
            } else res.style.display = "none";
        }

        function calcolaMacroSingolo() {
            const cat = document.getElementById('cal-cat').value;
            const key = document.getElementById('cal-alimento').value;
            const peso = parseFloat(document.getElementById('cal-peso').value);
            if(!peso) return;
            const d = db[cat][key];
            const res = document.getElementById('cal-res');
            res.style.display = "block";
            res.innerHTML = `<div class="macro-grid">
                <div class="macro-item"><span class="macro-val">${(d.kcal*peso/100).toFixed(0)}</span>Kcal</div>
                <div class="macro-item"><span class="macro-val">${(d.c*peso/100).toFixed(1)}g</span>Carbs</div>
                <div class="macro-item"><span class="macro-val">${(d.p*peso/100).toFixed(1)}g</span>Prot</div>
            </div>`;
        }

        function aggiungiPiatto() {
            const cat = document.getElementById('comp-cat').value;
            const key = document.getElementById('comp-alimento').value;
            const peso = parseFloat(document.getElementById('comp-peso').value);
            if(!peso) return;
            pasto.push({ ...db[cat][key], key, peso, cat, id: Date.now() });
            aggiornaPiattoUI();
        }

        function aggiornaPiattoUI() {
            document.getElementById('piatto-area').style.display = "block";
            const lista = document.getElementById('lista-piatto');
            lista.innerHTML = ""; let tk=0, tc=0, tp=0;
            pasto.forEach(i => {
                tk += (i.kcal*i.peso/100); tc += (i.c*i.peso/100); tp += (i.p*i.peso/100);
                lista.innerHTML += `<div class="plate-item"><span>${i[currentLang] || i.it} (${i.peso}g)</span><span style="color:red; cursor:pointer" onclick="rimuoviItem(${i.id})">âœ•</span></div>`;
            });
            lastMacros = {c:tc, p:tp};
            document.getElementById('totale-pasto-box').innerHTML = `<div class="macro-grid">
                <div class="macro-item"><span class="macro-val">${tk.toFixed(0)}</span>Kcal</div>
                <div class="macro-item"><span class="macro-val">${tc.toFixed(0)}g</span>Carbs</div>
                <div class="macro-item"><span class="macro-val">${tp.toFixed(0)}g</span>Prot</div>
            </div>`;
            rinfrescaAlternativa();
        }

        function rinfrescaAlternativa() {
            const pk = Object.keys(db.primo); const sk = Object.keys(db.secondo);
            const rP = pk[Math.floor(Math.random()*pk.length)];
            const rS = sk[Math.floor(Math.random()*sk.length)];
            const gP = (lastMacros.c / (db.primo[rP].c / 100)).toFixed(0);
            const gS = (lastMacros.p / (db.secondo[rS].p / 100)).toFixed(0);
            document.getElementById('testo-alternativa').innerHTML = `â€¢ ${gP}g <strong>${db.primo[rP][currentLang] || db.primo[rP].it}</strong><br>â€¢ ${gS}g <strong>${db.secondo[rS][currentLang] || db.secondo[rS].it}</strong>`;
        }

        function rimuoviItem(id) { pasto = pasto.filter(i => i.id !== id); aggiornaPiattoUI(); if(pasto.length===0) document.getElementById('piatto-area').style.display="none"; }
        function svuotaPiatto() { pasto = []; aggiornaPiattoUI(); document.getElementById('piatto-area').style.display="none"; }
        function closeModal() { document.getElementById('disclaimerModal').style.display = 'none'; }
        function openNav() { document.getElementById("mySidebar").style.width = "var(--drawer)"; }
        function closeNav() { document.getElementById("mySidebar").style.width = "0"; }
        function showSection(id) { document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); closeNav(); }
    </script>
</body>
</html>
